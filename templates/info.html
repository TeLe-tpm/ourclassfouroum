{% extends "base.html" %}

{% block page_title %}Информация{% endblock %}

{% block header_actions %}
    {% if current_user.role == 'admin' %}
    <button class="btn btn-primary" onclick="showInfoForm()">Добавить информацию</button>
    {% else %}
    <button class="btn btn-primary" onclick="showSuggestForm()">Предложить новость</button>
    {% endif %}
{% endblock %}

{% block content %}
{% if current_user.role == 'admin' %}
<div class="form-actions" id="infoForm" style="display: none;">
    <div class="form-group">
        <input type="text" id="infoTitle" placeholder="Заголовок" class="form-input">
    </div>
    <div class="form-group">
        <textarea id="infoContent" placeholder="Текст информации" class="form-input" rows="4"></textarea>
    </div>
    <div class="form-actions">
        <button onclick="addInfo()" class="btn btn-primary">Добавить</button>
        <button onclick="hideInfoForm()" class="btn btn-danger">Отмена</button>
    </div>
</div>
{% else %}
<div class="form-actions" id="suggestForm" style="display: none;">
    <div class="form-group">
        <input type="text" id="suggestTitle" placeholder="Заголовок предложения" class="form-input">
    </div>
    <div class="form-group">
        <textarea id="suggestContent" placeholder="Текст предложения" class="form-input" rows="4"></textarea>
    </div>
    <div class="form-actions">
        <button onclick="suggestNews()" class="btn btn-primary">Предложить</button>
        <button onclick="hideSuggestForm()" class="btn btn-danger">Отмена</button>
    </div>
</div>
{% endif %}

<div class="info-container" id="infoContainer">
    {% for post in info_posts %}
    <div class="post-card">
        <div class="post-header">
            <div class="post-author">{{ post.author.get_full_name() }}</div>
            <div class="post-date">{{ post.created_at.strftime('%d.%m.%Y %H:%M') }}</div>
        </div>
        <div class="post-content">
            <h3>{{ post.title }}</h3>
            <p>{{ post.content }}</p>
        </div>
    </div>
    {% else %}
    <div class="post-card">
        <div class="post-content">
            <p>Пока нет информации</p>
        </div>
    </div>
    {% endfor %}
</div>

<script>
{% if current_user.role == 'admin' %}
function showInfoForm() {
    document.getElementById('infoForm').style.display = 'block';
}

function hideInfoForm() {
    document.getElementById('infoForm').style.display = 'none';
}

function addInfo() {
    const title = document.getElementById('infoTitle').value;
    const content = document.getElementById('infoContent').value;
    
    if (!title || !content) {
        alert('Заполните все поля');
        return;
    }
    
    fetch('/add_info', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ title: title, content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Ошибка: ' + data.error);
        }
    })
    .catch(error => {
        alert('Ошибка сети');
    });
}
{% else %}
function showSuggestForm() {
    document.getElementById('suggestForm').style.display = 'block';
}

function hideSuggestForm() {
    document.getElementById('suggestForm').style.display = 'none';
}

function suggestNews() {
    const title = document.getElementById('suggestTitle').value;
    const content = document.getElementById('suggestContent').value;
    
    if (!title || !content) {
        alert('Заполните все поля');
        return;
    }
    
    fetch('/suggest_news', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ title: title, content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Предложение отправлено на модерацию');
            location.reload();
        } else {
            alert('Ошибка: ' + data.error);
        }
    })
    .catch(error => {
        alert('Ошибка сети');
    });
}
{% endif %}
</script>
{% endblock %}