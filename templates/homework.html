{% extends "base.html" %}

{% block page_title %}Домашнее задание{% endblock %}

{% block header_actions %}
    {% if current_user.role == 'admin' %}
    <button class="btn btn-primary" onclick="showHomeworkForm()">Добавить задание</button>
    {% endif %}
{% endblock %}

{% block content %}
{% if current_user.role == 'admin' %}
<div class="form-actions" id="homeworkForm" style="display: none;">
    <div class="form-group">
        <input type="text" id="homeworkSubject" placeholder="Предмет" class="form-input">
    </div>
    <div class="form-group">
        <textarea id="homeworkContent" placeholder="Задание" class="form-input" rows="4"></textarea>
    </div>
    <div class="form-group">
        <input type="text" id="homeworkDueDate" placeholder="Срок сдачи (например: 20.12.2024)" class="form-input">
    </div>
    <div class="form-actions">
        <button onclick="addHomework()" class="btn btn-primary">Добавить</button>
        <button onclick="hideHomeworkForm()" class="btn btn-danger">Отмена</button>
    </div>
</div>
{% endif %}

<div class="homework-container" id="homeworkContainer">
    {% for homework in homeworks %}
    <div class="homework-card">
        <div class="post-header">
            <div class="post-author">{{ homework.author.get_full_name() }}</div>
            <div class="post-date">{{ homework.created_at.strftime('%d.%m.%Y %H:%M') }}</div>
        </div>
        <div class="post-content">
            <h3>{{ homework.subject }}</h3>
            <p>{{ homework.content }}</p>
            {% if homework.due_date %}
            <p><strong>Сдать до:</strong> {{ homework.due_date }}</p>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="homework-card">
        <div class="post-content">
            <p>Пока нет домашних заданий</p>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function showHomeworkForm() {
    document.getElementById('homeworkForm').style.display = 'block';
}

function hideHomeworkForm() {
    document.getElementById('homeworkForm').style.display = 'none';
}

function addHomework() {
    const subject = document.getElementById('homeworkSubject').value;
    const content = document.getElementById('homeworkContent').value;
    const dueDate = document.getElementById('homeworkDueDate').value;
    
    if (!subject || !content) {
        alert('Заполните предмет и задание');
        return;
    }
    
    fetch('/add_homework', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ 
            subject: subject, 
            content: content,
            due_date: dueDate 
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Ошибка: ' + data.error);
        }
    })
    .catch(error => {
        alert('Ошибка сети');
    });
}
</script>
{% endblock %}